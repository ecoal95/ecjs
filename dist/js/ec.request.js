/*! EC.js - v0.1.0 - 2013-05-07
* Copyright (c) 2013 Emilio Cobos Álvarez; Licensed MIT */
(function(e,t){"use strict";EC.request=EC.request||function(e){var t;return e=EC.core.extend({method:"GET",url:"",requestContentType:null,data:null,jsonpCallbackField:"callback",processData:!0,onsuccess:null,onerror:null,async:!0,type:null,context:null},e),"jsonp"===e.type?EC.request.jsonp(e):(t=EC.request.create(),"GET"===e.method&&e.data&&(e.url+=(e.url.indexOf("?")>-1?"&":"?")+EC.request.generateQuery(e.data),e.data=null),t.open(e.method,e.url,e.async),e.requestContentType&&t.setRequestHeader&&t.setRequestHeader("Content-Type",e.requestContentType),t.onreadystatechange=function(){var n;4===t.readyState&&(200===t.status?(n="json"===e.type?EC.core.parseJSON(t.responseText):"xml"===e.type?t.responseXML:t.responseText,e.onsuccess&&"function"==typeof e.onsuccess&&e.onsuccess.call(e.context,n,t)):e.onerror&&"function"==typeof e.onerror&&e.onerror.call(e.context,n,t))},e.processData&&e.data&&(e.data=EC.request.generateQuery(e.data)),t.send(e.data),!0)},EC.core.extend(EC.request,{create:function(){return e.XMLHttpRequest?new e.XMLHttpRequest:new e.ActiveXObject("Microsoft.XMLHTTP")},generateQuery:function(t){var n,o=null;if("string"==typeof t||e.FormData&&t instanceof e.FormData)return t;for(n in t)t.hasOwnProperty(n)&&(o=null===o?n+"="+encodeURIComponent(t[n]):"&"+n+"="+encodeURIComponent(t[n]));return o},jsonp:function(n){var o,r="ec_"+ +new Date;return n.data=n.data||{},n.data[n.jsonpCallbackField]=r,e[r]=function(o){n.onsuccess&&"function"==typeof n.onsuccess&&n.onsuccess.call(n.context,o),e[r]=t},o=n.url+(n.url.indexOf("?")>-1?"&":"?")+EC.request.generateQuery(n.data),EC.core.loadJS(o,function(e){e.parentNode.removeChild(e)},n.onerror),!0},get:function(e,t){return EC.request({url:e,method:"GET",onsuccess:t})},post:function(e,t,n){return"string"==typeof e?EC.request({url:e,method:"POST",onsuccess:n,data:t}):EC.request(EC.core.extend({method:"POST"},e))}})})(window);